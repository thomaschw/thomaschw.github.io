<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.oldcodergarden.net","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="老码农的小花园">
<meta property="og:url" content="http://www.oldcodergarden.net/index.html">
<meta property="og:site_name" content="老码农的小花园">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chengwei">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.oldcodergarden.net/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>老码农的小花园</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">老码农的小花园</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.oldcodergarden.net/2022/08/17/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%A4%9A%E5%AA%92%E4%BD%93%E4%B8%AD%E5%BF%83%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chengwei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老码农的小花园">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/17/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%A4%9A%E5%AA%92%E4%BD%93%E4%B8%AD%E5%BF%83%E5%88%B6%E4%BD%9C/" class="post-title-link" itemprop="url">树莓派多媒体中心</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-17 21:22:28" itemprop="dateCreated datePublished" datetime="2022-08-17T21:22:28+08:00">2022-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-31 17:37:07" itemprop="dateModified" datetime="2022-08-31T17:37:07+08:00">2022-08-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我主要看国外影视剧，国内视频网站要么没有，要么删减（例如新版老友记）。美剧很多黄暴内容，家里还有小朋友，不能在客厅里看，所以在卧室里为自己打造了一个媒体中心。硬件是一块吃灰很久树莓派4B板子，软件是树莓派OS+kodi，之所以没有直接烧写LibreELEC或者OSMC，是觉得这样更灵活。系统还实现了BT下载和NAS等功能。<br>我把整个制作过程都记录了下来，林林总总写的比较长，没时间看完的同学可以直接烧写我的镜像。如果有问题可以参考下面的文档或者发邮件给我。<br>镜像下载链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/19jnDZ1vru5A9GqJX_Rx0hA">https://pan.baidu.com/s/19jnDZ1vru5A9GqJX_Rx0hA</a><br>提取码：hfdk</p>
<h2 id="硬件和注意事项"><a href="#硬件和注意事项" class="headerlink" title="硬件和注意事项"></a>硬件和注意事项</h2><p>树莓派4B板子，遥控器，红外接收头，按键开关，3D打印外壳，移动硬盘，蓝牙耳机和音箱，若干杜邦线。</p>
<h3 id="投影仪选购"><a href="#投影仪选购" class="headerlink" title="投影仪选购"></a>投影仪选购</h3><p>个人认为选购投影仪最重要的参数是亮度（流明）（当然还有钱啦）。亮度的单位是流明，代表的是某一尺寸和距离下幕布的明亮度。有ANSI流明和ISO流明两个标准，这两个数值其实是差不多的，一个是米国标准，一个是ISO标准，ANSI数值比ISO数值更大一些，对比两款投影仪时 ANSI需要打个小折扣。注意有的奸商会用光源亮度替换ANSI和ISO亮度，这个就是骗人了，注意区别。建议选择3000流明以上投影仪的，投影仪按光源分有三种 灯泡，激光和LED。3000流明以上亮度LED光源是做不到的，只有激光和灯泡能达到，但激光光源3000流明以上投影仪要贵很多。<br>我用的是夏普的投影仪TW750（3300流明，240HZ，1080p），灯泡光源，直接投在白墙上也挺清晰和鲜艳，只是风扇噪声比较大。</p>
<h3 id="蓝牙音箱选购"><a href="#蓝牙音箱选购" class="headerlink" title="蓝牙音箱选购"></a>蓝牙音箱选购</h3><p>因为没当时没考虑到要在卧室里看电影，所以装修时没有安装音频线，只能用蓝牙音箱,好在要求不高可以凑合,买了一个红米的sound bar，99块钱音质实在是不忍听。我大多数都戴着耳机看，免得打扰到别人，没有别墅就和音箱绝缘吧。蓝牙耳机用的是苹果和网易的蓝牙耳机。蓝牙耳机不方便的地方只能自己看，似乎没有办法接多个耳机。</p>
<h3 id="3D打印外壳"><a href="#3D打印外壳" class="headerlink" title="3D打印外壳"></a>3D打印外壳</h3><p>用3D打印机制作了外壳，外壳分为三部分。装移动硬盘部分，树莓派部分和盖子，通过卡扣组合在一起。没怎么考虑散热问题，未来可能需要改进<br>使用草图大师设计，创想3维的打印机打印出来。设计文件和切片文件都放在网盘上了。</p>
<p>成品图<br><img src="/images/raspmediacenter/3dshell/1.jpg" alt="1"><br><img src="/images/raspmediacenter/3dshell/2.jpg" alt="2"><br><img src="/images/raspmediacenter/3dshell/3.jpg" alt="3"></p>
<h2 id="树莓派系统准备工作"><a href="#树莓派系统准备工作" class="headerlink" title="树莓派系统准备工作"></a>树莓派系统准备工作</h2><h3 id="烧写树莓派"><a href="#烧写树莓派" class="headerlink" title="烧写树莓派"></a>烧写树莓派</h3><p>使用树莓派官方烧写工具Raspberry Pi Imager烧写镜像。软件下载地址<a target="_blank" rel="noopener" href="https://www.raspberrypi.com/software/">https://www.raspberrypi.com/software/</a>。<br><img src="/images/raspmediacenter/raspibase/image0.PNG" alt="raspiimager"><br>选择pi os(64-bit),按道理64位系统性能更好一些<br><img src="/images/raspmediacenter/raspibase/image1.PNG"><br>点击齿轮进行高级设置<br><img src="/images/raspmediacenter/raspibase/image21.PNG"><br>可以在烧写时开启SSH和VNC，可以在没有显示器情况登陆树莓派。如果这里没有设置SSH默认是关闭的，需要接显示器和键盘鼠标开启SSH。<br><img src="/images/raspmediacenter/raspibase/image3.PNG"><br>选择要烧写SD卡<br><img src="/images/raspmediacenter/raspibase/image2.PNG"><br>烧写中<br><img src="/images/raspmediacenter/raspibase/image4.PNG"><br>如果网络不好需要先下载os镜像在烧写  </p>
<h3 id="树莓派设置"><a href="#树莓派设置" class="headerlink" title="树莓派设置"></a>树莓派设置</h3><p>执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo raspi-config</span><br></pre></td></tr></table></figure>

<p>显示下面界面<br><img src="/images/raspmediacenter/raspibase/imagesetting0.PNG" alt="raspiconfig"><br>如果开始没有设置SSH登陆，可以在这里设置</p>
<h3 id="更换软件源"><a href="#更换软件源" class="headerlink" title="更换软件源"></a>更换软件源</h3><p>由于树莓派官方软件源速度非常慢，可以选择国内镜像，我使用清华的镜像。</p>
<p>清华镜像网站有详细说明<br><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/">https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/</a><br>如何修改&#x2F;etc&#x2F;apt&#x2F;source.list</p>
<h2 id="安装开关"><a href="#安装开关" class="headerlink" title="安装开关"></a>安装开关</h2><p>树莓派没有开关机键，关机一般是敲命令，开机插拔电源电源，比较麻烦。所以装上一个开关，像一个产品。<br><img src="/images/raspmediacenter/switch/IMG_1721.jpg" alt="成品"><br>硬件连接<br>在树莓派的GPIO3（BCM3）和GND引脚之间接一个按键<br><img src="/images/raspmediacenter/switch/gpio.png" alt="硬件连接图"><br>在&#x2F;boot&#x2F;config.txt进行配置，在文件末尾增加一行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dtoverlay=gpio-shutdown</span><br></pre></td></tr></table></figure>

<p>想更深入了解硬件相关内容可以参考<br>&#x2F;boot&#x2F;overlays&#x2F;README<br>里面详细说明了硬件怎么配置。</p>
<h2 id="kodi安装和基本设置"><a href="#kodi安装和基本设置" class="headerlink" title="kodi安装和基本设置"></a>kodi安装和基本设置</h2><h3 id="安装与启动"><a href="#安装与启动" class="headerlink" title="安装与启动"></a>安装与启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install kodi</span><br></pre></td></tr></table></figure>

<p>由于我们要使用蓝牙耳机，需要使用pulseaaudio,启动加上 –pulse</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kodi --pulse</span><br></pre></td></tr></table></figure>

<p>图形界面快捷方式也需要修改<br><img src="/images/raspmediacenter/kodibase/kodishortcut.png" alt="kodishortcut"><br>修改Desktop Entry下Command<br><img src="/images/raspmediacenter/kodibase/kodiset2.png" alt="kodishortcut2"></p>
<h3 id="设置中文界面"><a href="#设置中文界面" class="headerlink" title="设置中文界面"></a>设置中文界面</h3><p>kodi中文设置请按照我下面的顺序修改，否则会出现乱码，就回不去了。</p>
<p><img src="/images/raspmediacenter/kodibase/kodisetlag1.png" alt="zh-cn"><br><img src="/images/raspmediacenter/kodibase/kodisetlag2.png" alt="zh-cn"><br><img src="/images/raspmediacenter/kodibase/kodisetlag3.png" alt="zh-cn"><br><img src="/images/raspmediacenter/kodibase/kodisetlag4.png" alt="zh-cn"><br><img src="/images/raspmediacenter/kodibase/kodisetlag5.png" alt="zh-cn"></p>
<h3 id="添加视频源"><a href="#添加视频源" class="headerlink" title="添加视频源"></a>添加视频源</h3><p>用惯了电脑播放器同学刚开始可能不太习惯kodi，会问视频在哪里，怎么打开?<br>kodi需要先添加视频文件夹到软件，也就是添加视频源。可以添加本地文件夹，也可以添加网络共享，支持各种协议。我一个添加NAS共享samba的例子:<br><img src="/images/raspmediacenter/kodibase/kodiaddsource.gif" alt="videosource"></p>
<h2 id="使用红外遥控器"><a href="#使用红外遥控器" class="headerlink" title="使用红外遥控器"></a>使用红外遥控器</h2><h3 id="硬件与驱动配置"><a href="#硬件与驱动配置" class="headerlink" title="硬件与驱动配置"></a>硬件与驱动配置</h3><ol>
<li>硬件<br>家里淘汰的红外遥控器。<br><img src="/images/raspmediacenter/InfraredRC/infraterc.png" alt="遥控器"><br>一个红外接收器，买树莓派时商家送的，型号应该是VS1838B。<br><img src="/images/raspmediacenter/InfraredRC/vs1838b.png" alt="VS1838B"><br>在上面接了电阻和发光二极管，有信号时会发红光闪<br><img src="/images/raspmediacenter/InfraredRC/infrarec.png" alt="infraderev"><br>将电路接到树莓派上，将S信号接到GPIO17，负极接地，正极接5V<br><img src="/images/raspmediacenter/InfraredRC/infragpio.jpg" alt="gpio"><br>接好之后<br><img src="/images/raspmediacenter/InfraredRC/infrashan.gif" alt="gpio"><br>红外接收二极管可以直接放在盒子里，红外信号可以穿过3D打印的盒子，做第一版3D打印外壳时还开了个洞属于多余了。</li>
<li>驱动配置：<br>修改 &#x2F;boot&#x2F;config.txt，将</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dtoverlay=gpio-ir,gpio_pin=17</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dtoverlay=gpio-ir-tx,gpio_pin=18 <span class="comment"># 只配置接收可不修改</span></span></span><br></pre></td></tr></table></figure>

<p>修改为  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  dtoverlay=gpio-ir,gpio_pin=17 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dtoverlay=gpio-ir-tx,gpio_pin=18 <span class="comment"># 只配置接收可不修改</span></span>  </span><br></pre></td></tr></table></figure>

<p>GPIO17对应红外接收，去掉#号，保存文件后重启，GPIO18对应红外发射，只配置接收时可以不修改。<br>重启后在&#x2F;dev&#x2F;目录下会出现lirc0或lirc1,修改成功！</p>
<h3 id="lirc配置"><a href="#lirc配置" class="headerlink" title="lirc配置"></a>lirc配置</h3><p>lirc全称linux infrared remote control,linux下红外遥控器管理软件包，我使用lirc版本是0.10.1。操作系统Raspberry os 64bit（2022-04-04），内核是linux raspberrypi 5.10.x。<br>我配置的是我自己找到的不知到型号的遥控器，如果你烧写我的镜像，使用你自己的遥控器，那就需要你重新录制了，所以我把整个过程写的详细一些。</p>
<h4 id="1-lirc安装与设备配置"><a href="#1-lirc安装与设备配置" class="headerlink" title="1.lirc安装与设备配置"></a>1.lirc安装与设备配置</h4><p>lirc安装：  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install lirc</span><br></pre></td></tr></table></figure>

<p>在上面修改驱动配置后 &#x2F;dev下会出现lirc0或lirc1设备，根据设备修改&#x2F;etc&#x2F;lirc&#x2F;lirc_options.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver          = default</span><br><span class="line">device          = /dev/lirc0</span><br></pre></td></tr></table></figure>

<h4 id="2-红外接收测试与红外编码简介"><a href="#2-红外接收测试与红外编码简介" class="headerlink" title="2.红外接收测试与红外编码简介"></a>2.红外接收测试与红外编码简介</h4><p>输入命令  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mode2 -d /dev/lirc0</span><br></pre></td></tr></table></figure>

<p>按下遥控器，如果上面步骤正确会有输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Using device: /dev/lirc0</span><br><span class="line">   pulse 9005</span><br><span class="line">   space 4482</span><br><span class="line">   pulse 576</span><br><span class="line">   space 1681</span><br><span class="line">   pulse 574</span><br><span class="line">   .</span><br><span class="line">   .</span><br><span class="line">   .</span><br><span class="line">   space 586</span><br><span class="line">   pulse 542</span><br><span class="line">   space 39678</span><br><span class="line">   pulse 9000</span><br><span class="line">   space 2239</span><br><span class="line">   pulse 561</span><br><span class="line">   space 96071</span><br><span class="line">   pulse 8998</span><br><span class="line">   space 2241</span><br><span class="line">   pulse 565</span><br><span class="line">   space 96065</span><br><span class="line">   pulse 9004</span><br><span class="line">   space 2235</span><br><span class="line">   pulse 572</span><br><span class="line">   timeout 138031</span><br></pre></td></tr></table></figure>

<p>代表硬件和lirc工作正常。<br>红外遥控编码格式，可以和上面输出一起理解<br><img src="/images/raspmediacenter/InfraredRC/infracode.png" alt="code"><br>红外编码108ms一个周期，起始码9ms，低电平4.5ms 对应上面遥控器输出pulse 9005,space 4482。后面是数据码，每个按键都有自己的数据码，这也是识别按键的基础。最后是空码低电平30ms以上对应space 39678。在后面是连发码也是108ms( pulse 9000 space 2239 pulse 561 space 96071)。</p>
<h4 id="3-遥控器按键录制"><a href="#3-遥控器按键录制" class="headerlink" title="3.遥控器按键录制"></a>3.遥控器按键录制</h4><p>简单了解上面的红外编码后，我们可以录制我们的遥控器。<br>lirc软件包有一个irrecord命令可以配置按键。<br>配置时按键可以用预定义键值，也可以自定义键值。使用lirc预定义键值时输入命令查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irrecord -l</span><br></pre></td></tr></table></figure>

<p>我使用的预定键值，没有去自定义。<br> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">irrecord -f -d /dev/lirc0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先是说明，看看后回车</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等几秒，不要按遥控器，程序检测周围有没有干扰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等提示输入遥控器名称</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后随机按下按键，每个键按至少一秒，直到生成两排80个点，这一步应该是测试遥控器的信号强度</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下面就是开始录制按键了，先输入按键名字在按下遥控器按键，重复直到所有按键完成，可以用预定按键名称，也可以自定义按键名称，需要在开始命令加上-n。</span></span><br></pre></td></tr></table></figure></p>
<p>   录下来的文件可能是这样的<br>   <img src="/images/raspmediacenter/InfraredRC/config.PNG" alt="config"><br>   可以看出KEY_2,KEY_3录入错误了，录成了连发码了。<br>   改正有两种办法，第一种方法是更新文件 参数-u更新文件</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irrecord -f -d /dev/lirc0 -u skyworthunknown.lircd.conf</span><br></pre></td></tr></table></figure>

<p>   从新录错误的按键直到录对为止。<br>   第二种方法是手工编辑文件 先输入命令  mode2 -m -d &#x2F;dev&#x2F;lirc0,按下一个按键 如下输出</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mode2 -m -d /dev/lirc0</span><br><span class="line">Using driver default on device /dev/lirc0</span><br><span class="line">Trying device: /dev/lirc0</span><br><span class="line">Using device: /dev/lirc0</span><br><span class="line">16777215</span><br><span class="line"></span><br><span class="line">8930     4556      502     1750      530      597</span><br><span class="line">   503      625      503      623      530      597</span><br><span class="line">   504      627      504      621      507      622</span><br><span class="line">   502     1752      504      626      501     1751</span><br><span class="line">   505     1757      496     1751      529     1728</span><br><span class="line">   502     1775      479     1776      479      647</span><br><span class="line">   506     1750      481     1753      502     1752</span><br><span class="line">   526      623      479      647      479     1778</span><br><span class="line">   477     1775      480     1754      500      624</span><br><span class="line">   503      627      501      646      486     1769</span><br><span class="line">   480     1754      501      647      480      648</span><br><span class="line">   479    39761</span><br><span class="line"></span><br><span class="line">  8914     2323      478    96139</span><br><span class="line"></span><br><span class="line">  8940     2298      502    96100</span><br><span class="line"></span><br><span class="line">  8930     2325      504    96106</span><br><span class="line"></span><br><span class="line">  8933     2308      499    96125</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>   从开始码 8930 复制到 空码低电平39761 注意39761不要复制。复制到对应 name KEY_XXX下面。<br>   没有KEY可以新建一个。每个按键最后空码低电平时间 可能会不同，但都显著长于数字码，30000以上。<br>   将录制好的conf文件拷贝到 &#x2F;etc&#x2F;lirc&#x2F;lircd.conf.d&#x2F;<br>   然后重启lirc</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/lircd restart</span><br></pre></td></tr></table></figure>

<h4 id="4-遥控器测试"><a href="#4-遥控器测试" class="headerlink" title="4.遥控器测试"></a>4.遥控器测试</h4><p>输入irw 命令按键会出现结果<br>   <img src="/images/raspmediacenter/InfraredRC/irw.PNG" alt="irw">  </p>
<h3 id="使用遥控器启动kodi"><a href="#使用遥控器启动kodi" class="headerlink" title="使用遥控器启动kodi"></a>使用遥控器启动kodi</h3><h4 id="遥控器启动程序基本操作"><a href="#遥控器启动程序基本操作" class="headerlink" title="遥控器启动程序基本操作"></a>遥控器启动程序基本操作</h4><p>使用遥控器启动程序，主要依靠irexec程序，看它的名字类似于linux exec命令。<br> 先测试一下遥控器执行程序irexec。<br>在~&#x2F;.config&#x2F;文件夹下新建lircrc文件 输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">  remote = skyworthunknown</span><br><span class="line">  button = KEY_MACRO1</span><br><span class="line">  prog = irexec</span><br><span class="line">  config = echo &quot;TEST!!!!&quot;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>启动 irexec</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irexec</span><br></pre></td></tr></table></figure>

<p>按下遥控器按键 MACRO1，可以看到输出  </p>
<p><img src="/images/raspmediacenter/InfraredRC/TEST.PNG" alt="TEST">  </p>
<p>接下来我们用遥控器启动kodi。<br>新建一个startkodi.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ -n &quot;$(ps -A|grep -v grep|grep -i kodi.bin)&quot; ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;kodi have opened!!!&quot;</span><br><span class="line">else</span><br><span class="line">   /usr/bin/kodi --pulse</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;kodi not open!!&quot;</span></span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>chmod +x startkodi.sh<br>将lircrc修改为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">    remote = skyworthunknown</span><br><span class="line">    button = KEY_MACRO1</span><br><span class="line">    prog = irexec</span><br><span class="line">    config = /home/pi/startkodi.sh</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>启动irexec,按下按键<br><img src="/images/raspmediacenter/InfraredRC/startkodi.gif" alt="start"><br>启动成功！！！<br>将irexec加入开机启动，在安装lirc时在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;已经创建了irexec.service,这个文件需要修改一下，按照下面进行修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Documentation=man:irexec(1)</span><br><span class="line">Documentation=http://lirc.org/html/configure.html</span><br><span class="line">Documentation=http://lirc.org/html/configure.html#lircrc_format</span><br><span class="line">Description=Handle events from IR remotes decoded by lircd(8)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将用户改成pi，如果不修改irexec会以root用户启动，kodi也会从root启动，导致kodi设置文件夹出现在root下，导致错误。</span></span><br><span class="line">[Service]  </span><br><span class="line">User=pi  #注意是User 第一个字母大写</span><br><span class="line">Group=pi #注意是Group 第一个字幕大写G</span><br><span class="line"></span><br><span class="line">; Hardening opts, see systemd.exec(5).  Doesnt add much unless</span><br><span class="line">; not running as root. If these are applicable or not depends on</span><br><span class="line">; what commands irexec.lircrc invokes.</span><br><span class="line">;</span><br><span class="line">; NoNewPrivileges=true</span><br><span class="line">; MemoryDenyWriteExecute=true</span><br><span class="line">; PrivateTmp=true</span><br><span class="line">; ProtectHome=true</span><br><span class="line">; ProtectSystem=full</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/irexec /home/pi/.config/lircrc</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable irexec.service</span><br></pre></td></tr></table></figure>

<p>重启！！！似乎成功了？高兴太早了。</p>
<h4 id="解决systemd-启动kodi音频问题"><a href="#解决systemd-启动kodi音频问题" class="headerlink" title="解决systemd 启动kodi音频问题"></a>解决systemd 启动kodi音频问题</h4><p>我们虽然加了–pulse 参数。systemd管理下程序运行kodi  pulseaudio 无法启动成功，也就无法使用蓝牙耳机，我试图解决这个问题，但没有成功，那位知道的高人可以指点一下<br>我想了一个办法绕过这个问题，新建两个程序startkodisender,startkodireciver。startkodireciver负责启动kodi，在开机时启动，循环等待启动kodi命令。startkodisender,负责发送启动命令，由irexec调用。命令通过消息队列message quene来发送。<br>startkodireciver.cpp 代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 0x100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">msg_buf</span> &#123;</span><br><span class="line">    <span class="type">long</span> msg_type;</span><br><span class="line">    <span class="type">char</span> msg_txt[MAX];</span><br><span class="line">&#125; message;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> loop;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">signal_handler</span><span class="params">(<span class="type">int</span> signalnum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    loop = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">key_t</span> key;</span><br><span class="line">    <span class="type">int</span> msgid;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">signal</span>(SIGINT,signal_handler);</span><br><span class="line"></span><br><span class="line">    loop = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    key = <span class="built_in">ftok</span>(<span class="string">&quot;/dev/block&quot;</span>,<span class="number">65</span>);</span><br><span class="line"></span><br><span class="line">    msgid = <span class="built_in">msgget</span>(key,<span class="number">0666</span>|IPC_CREAT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(loop)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">msgrcv</span>(msgid,&amp;message,<span class="built_in">sizeof</span>(message.msg_txt),<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;rev cmd: %s\n&quot;</span>,message.msg_txt);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(message.msg_txt,<span class="string">&quot;startkodi&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">system</span>(<span class="string">&quot;/home/pi/startkodi.sh&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">msgctl</span>(msgid,IPC_RMID,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>startkodisender.cpp 代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">mesg_buffer</span> &#123;</span><br><span class="line">   <span class="type">long</span> mesg_type;</span><br><span class="line">   <span class="type">char</span> mesg_text[MAX];</span><br><span class="line">&#125; message;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="type">key_t</span> key;</span><br><span class="line">   <span class="type">int</span> msgid;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(argc&lt;<span class="number">2</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   key = <span class="built_in">ftok</span>(<span class="string">&quot;/dev/block&quot;</span>,<span class="number">65</span>);</span><br><span class="line"></span><br><span class="line">   msgid = <span class="built_in">msgget</span>(key,<span class="number">0666</span>|IPC_CREAT);</span><br><span class="line"></span><br><span class="line">   message.mesg_type = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">memset</span>(message.mesg_text,<span class="number">0</span>,<span class="built_in">sizeof</span>(message.mesg_text));</span><br><span class="line"></span><br><span class="line">   <span class="built_in">strncpy</span>(message.mesg_text,argv[<span class="number">1</span>],<span class="built_in">sizeof</span>(message.mesg_text)<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> len = <span class="built_in">strlen</span>(message.mesg_text);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">msgsnd</span>(msgid,&amp;message,len+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将startkodireciver添加到开机启动，修改&#x2F;etc&#x2F;rc.local 增加一行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - pi -c /home/pi/dev/startkodi/startkodireciver &amp;</span><br></pre></td></tr></table></figure>

<p>增加按下遥控器发送命令修改&#x2F;home&#x2F;pi&#x2F;.config&#x2F;lircrc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">  remote = skyworthunknown</span><br><span class="line">  button = KEY_MACRO1</span><br><span class="line">  prog = irexec</span><br><span class="line">  config = /home/pi/dev/source/send startkodi</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>重启后按键可以启动kodi，并且pulseaudio正常了</p>
<h3 id="kodi遥控器按键映射"><a href="#kodi遥控器按键映射" class="headerlink" title="kodi遥控器按键映射"></a>kodi遥控器按键映射</h3><p>需要把lirc的键值映射到kodi按键，遥控器在kodi中才能起作用，可以参考kodi文档<br><a target="_blank" rel="noopener" href="https://kodi.wiki/view/LIRC#:~:text=The%20file%20is%20literally%20named,stored%20in%20the%20userdata%20directory.">https://kodi.wiki/view/LIRC#:~:text=The%20file%20is%20literally%20named,stored%20in%20the%20userdata%20directory.</a></p>
<p>主要涉及到两个文件remote.xml和Lircmap.xml &#x2F;usr&#x2F;share&#x2F;kodi&#x2F;system&#x2F;keymap&#x2F;remote.xml是kodi定义的遥控按键，这个文件不需要修改，用来做参考查看kodi有哪些按键。<br>然后修改&#x2F;usr&#x2F;share&#x2F;kodi&#x2F;system&#x2F;Lircmap.xml，增加我们在lirc中定义的遥控器。格式是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;remote device=&quot;遥控器名字&quot;&gt;</span><br><span class="line">   &lt;kodi_button&gt;LIRC_KEY&lt;/kodi_button&gt;</span><br><span class="line">&lt;/remote&gt;</span><br></pre></td></tr></table></figure>

<p>下面是我的遥控器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;remote device=&quot;skyworthunknown&quot;&gt;</span><br><span class="line">   &lt;left&gt;KEY_LEFT&lt;/left&gt;</span><br><span class="line">   &lt;right&gt;KEY_RIGHT&lt;/right&gt;</span><br><span class="line">   &lt;up&gt;KEY_UP&lt;/up&gt;</span><br><span class="line">   &lt;down&gt;KEY_DOWN&lt;/down&gt;</span><br><span class="line">   &lt;select&gt;KEY_OK&lt;/select&gt;</span><br><span class="line">   &lt;back&gt;KEY_BACK&lt;/back&gt;</span><br><span class="line">   &lt;one&gt;KEY_1&lt;/one&gt;</span><br><span class="line">   &lt;two&gt;KEY_2&lt;/two&gt;</span><br><span class="line">   &lt;three&gt;KEY_3&lt;/three&gt;</span><br><span class="line">   &lt;four&gt;KEY_4&lt;/four&gt;</span><br><span class="line">   &lt;five&gt;KEY_5&lt;/five&gt;</span><br><span class="line">   &lt;six&gt;KEY_6&lt;/six&gt;</span><br><span class="line">   &lt;seven&gt;KEY_7&lt;/seven&gt;</span><br><span class="line">   &lt;eight&gt;KEY_8&lt;/eight&gt;</span><br><span class="line">   &lt;nine&gt;KEY_9&lt;/nine&gt;</span><br><span class="line">   &lt;zero&gt;KEY_0&lt;/zero&gt;</span><br><span class="line">   &lt;mute&gt;KEY_MUTE&lt;/mute&gt;</span><br><span class="line">   &lt;volumeplus&gt;KEY_VOLUMEUP&lt;/volumeplus&gt;</span><br><span class="line">   &lt;volumeminus&gt;KEY_VOLUMEDOWN&lt;/volumeminus&gt;</span><br><span class="line">   &lt;menu&gt;KEY_MENU&lt;/menu&gt;</span><br><span class="line">&lt;/remote&gt;</span><br></pre></td></tr></table></figure>

<p>不想修改&#x2F;usr&#x2F;share&#x2F;kodi&#x2F;system&#x2F;Lircmap.xml也可以在<del>&#x2F;.kodi&#x2F;userdata&#x2F;下增加Lircmap.xml，我在</del>&#x2F;.kodi&#x2F;userdata&#x2F;下增加Lircmap.xml,这样在删除和重装情况下，配置不会丢失。</p>
<h2 id="kodi进阶之刮削器"><a href="#kodi进阶之刮削器" class="headerlink" title="kodi进阶之刮削器"></a>kodi进阶之刮削器</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>刮削器(scraper)是kodi的一个有用的特色，它能获得电影和电视剧的信息，如海报、评分、演员、简介等的，并将信息展示在屏幕上。<br><img src="/images/raspmediacenter/kodiscraper/demoscraper.gif" alt="演示图"><br>它是kodi插件（addon）一种。插件是kodi玩法中最有意思的一种，可惜由于墙的问题，国外插件基本用不了，国内插件社区不活跃，现有插件都没人维护大多不能用了，例如豆瓣刮削器就不能用了。</p>
<h3 id="使用TheMovieDB（TMDB）刮削器"><a href="#使用TheMovieDB（TMDB）刮削器" class="headerlink" title="使用TheMovieDB（TMDB）刮削器"></a>使用TheMovieDB（TMDB）刮削器</h3><p> kodi使用TMDB(<a target="_blank" rel="noopener" href="http://www.themoviedb.com/">www.themoviedb.com</a>) 数据，kodi安装时已经默认安装了电影和电视剧刮削器 在系统&#x2F;插件&#x2F;我的插件&#x2F;信息提供者中可以找到<br><img src="/images/raspmediacenter/kodiscraper/infoscraper.gif" alt="gifscraper"><br>电影刮削器<br><img src="/images/raspmediacenter/kodiscraper/Kodimovie.png" alt="movies-scraper"><br>The Movie Database和The Movie Database Python 功能是相同的都是获取tmdb网站信息，只是The Movie Database使用xml正则表达式实现的，而The Movie Database Python使用python实现的<br>电视剧刮削器<br><img src="/images/raspmediacenter/kodiscraper/koditv.png" alt="tv-scraper"><br>和电影刮削器一样，The Movie Database是xml正则表达式实现，TMDB TV Shows是python实现。<br>我使用python实现刮削器，xml实现的刮削器太老了，我不想去修改它了。</p>
<h3 id="解决themoviedb被墙的问题"><a href="#解决themoviedb被墙的问题" class="headerlink" title="解决themoviedb被墙的问题"></a>解决themoviedb被墙的问题</h3><p>tmdb刮削器并不能正常工作，因为api.themoviedb.org被墙了，网上改host方法并不管用。原因是域名会被解析到twiter和facebook的ip段会被墙，而host强制解析到亚马逊云ip地址会被亚马逊cloud front屏蔽。  </p>
<p>一个简单的方法是访问api.tmdb.org代替api.themoviedb.org,需要去改一下插件代码。我能看懂python，所以修改刮削器python版本。<br>刮削器有电影刮削器和电视剧（TV）刮削器，位置在<del>&#x2F;.kodi&#x2F;metadata.themoviedb.org.python和</del>&#x2F;.kodi&#x2F;metadata.tvshows.themoviedb.org.python<br>修改电影刮削器 修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.kodi/addons/metadata.themoviedb.org.python/python/lib/tmdbscraper/tmdbapi.py</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL=&#x27;https://api.thmoviedb.org/3/&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL=&#x27;https://api.tmdb.org/3/&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>修改电视剧刮削器<br>编辑~&#x2F;.kodi&#x2F;addons&#x2F;metadata.tvshows.themoviedb.org.python&#x2F;libs下的tmdb.py,data_utils.py和settings.py，将三个文件中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL=&#x27;https://api.thmoviedb.org/3/&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL=&#x27;https://api.tmdb.org/3/&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>同时在刮削器设置里将预告片选项关闭，重要！！！因为刮削器实在youtube上获取预告片，会使刮削器卡死在获取预告片进程里。</p>
<h3 id="影视文件命名和刮削器设置"><a href="#影视文件命名和刮削器设置" class="headerlink" title="影视文件命名和刮削器设置"></a>影视文件命名和刮削器设置</h3><p>懒得写了，官方wiki写的非常详细，大家可以参考<br><a target="_blank" rel="noopener" href="https://kodi.wiki/view/HOW-TO:Create_Video_Library">https://kodi.wiki/view/HOW-TO:Create_Video_Library</a></p>
<h3 id="刮削结果导出"><a href="#刮削结果导出" class="headerlink" title="刮削结果导出"></a>刮削结果导出</h3><p>参考官方wiki<br><a target="_blank" rel="noopener" href="https://kodi.wiki/view/Movie_set_information_folder#Introduction">https://kodi.wiki/view/Movie_set_information_folder#Introduction</a></p>
<h2 id="kodi进阶之直播"><a href="#kodi进阶之直播" class="headerlink" title="kodi进阶之直播"></a>kodi进阶之直播</h2><h3 id="安装ip-simple-client"><a href="#安装ip-simple-client" class="headerlink" title="安装ip simple client"></a>安装ip simple client</h3><p>树莓派下这个直播插件不能从插件库安装，而是直接从软件库安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install kodi-pvr-iptvsimple</span><br></pre></td></tr></table></figure>

<h3 id="直播源，m3u文件和电子节目单-epg-XML文件"><a href="#直播源，m3u文件和电子节目单-epg-XML文件" class="headerlink" title="直播源，m3u文件和电子节目单(epg) XML文件"></a>直播源，m3u文件和电子节目单(epg) XML文件</h3><p>直播源：网上搭建的转播电视台流媒体流媒体服务器，一般不对外公开的，有些人通过爬虫或者某些手段获得并整理地址，我推荐一个人整理的直播地址，我用他江苏的直播列表，一直都能用。网址<a target="_blank" rel="noopener" href="https://github.com/SPX372928/MyIPTV">https://github.com/SPX372928/MyIPTV</a><br>M3U文件：M3U文件是用来记录音视频文件片段列表的，这里用来记录直播源，格式是这样的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">EXTM3U</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">EXTINF:-1 tvg-id=<span class="string">&quot;106&quot;</span> tvg-name=<span class="string">&quot;CCTV4K&quot;</span> tvg-logo=<span class="string">&quot;http://epg.51zmt.top:8000/tb1/CCTV/CCTV4k.png&quot;</span> group-title=<span class="string">&quot;央视&quot;</span>,CCTV4K 16M2160</span></span><br><span class="line">http://ott.mobaibox.com/PLTV/3/224/3221228228/index.m3u8</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">EXTINF:-1 tvg-id=<span class="string">&quot;141&quot;</span> tvg-name=<span class="string">&quot;凤凰中文&quot;</span> tvg-logo=<span class="string">&quot;http://epg.51zmt.top:8000/tb1/gt/fenghuangzhongwen.png&quot;</span> group-title=<span class="string">&quot;港澳台&quot;</span>,凤凰中文 8M1080</span></span><br><span class="line">http://ott.mobaibox.com/PLTV/3/224/3221228057/index.m3u8</span><br></pre></td></tr></table></figure>

<p>文件以#EXTM3U开头，然后每个#EXTINF记录一个直播源信息，包括直播名字，图标，分组和直播源网络地址。<br>电子节目单(EPG):电子节目单顾名思义，记录了频道名称和节目时间，一般每天都会更新，这个网址<a target="_blank" rel="noopener" href="http://epg.51zmt.top:8000/e.xml">http://epg.51zmt.top:8000/e.xml</a>提供节目单并且每天会更新两次。</p>
<h3 id="IPTV-Simple-Client-设置"><a href="#IPTV-Simple-Client-设置" class="headerlink" title="IPTV Simple Client 设置"></a>IPTV Simple Client 设置</h3><p>知道了上面这些概念我们就可以设置直播了,先生成M3U文件。<br>从<a target="_blank" rel="noopener" href="https://github.com/SPX372928/MyIPTV">https://github.com/SPX372928/MyIPTV</a>下载一个直播源文件（txt），在这个网站上传<a target="_blank" rel="noopener" href="http://epg.51zmt.top:8000/">http://epg.51zmt.top:8000/</a>等待一会后就生成了带有台标的m3u文件,下载下来就可以了<br><img src="/images/raspmediacenter/livestreaming/iptvm3u1.PNG" alt="iptvm3u"></p>
<p>在系统-&gt;插件-&gt;我的插件-&gt;pvr客户端找到iptv simple client<br><img src="/images/raspmediacenter/livestreaming/tvset1.png" alt="1"><br><img src="/images/raspmediacenter/livestreaming/tvset2.png" alt="2"><br><img src="/images/raspmediacenter/livestreaming/tvset3.png" alt="3"><br><img src="/images/raspmediacenter/livestreaming/tvset4.png" alt="4"><br><img src="/images/raspmediacenter/livestreaming/tvset5.png" alt="5"><br>将上面下载的m3u直播源文件填入路径列表<br><img src="/images/raspmediacenter/livestreaming/tvset6.png" alt="6"><br>将电子节目单<a target="_blank" rel="noopener" href="http://epg.51zmt.top:8000/e.xml%E5%A1%AB%E5%85%A5XMLTV">http://epg.51zmt.top:8000/e.xml填入XMLTV</a> URL<br><img src="/images/raspmediacenter/livestreaming/tvset7.png" alt="7"><br>下面是电子节目单和看CCTV的效果<br><img src="/images/raspmediacenter/livestreaming/tvxg1.png" alt="1"><br><img src="/images/raspmediacenter/livestreaming/tvxg2.png" alt="2"><br><img src="/images/raspmediacenter/livestreaming/tvxg4.png" alt="3"></p>
<h2 id="kodi进阶之投屏"><a href="#kodi进阶之投屏" class="headerlink" title="kodi进阶之投屏"></a>kodi进阶之投屏</h2><h2 id="BT下载软件使用"><a href="#BT下载软件使用" class="headerlink" title="BT下载软件使用"></a>BT下载软件使用</h2><p>美剧和国外电影主要还是通过BT下载获得，同时使用树莓派作为下载机，解放我的工作电脑。<br>下载软件有qbittorrent,transmission和aria2，各有特色大家可以选择使用。我主要使用aria2，qbittorent和transmission介绍比较简单</p>
<h3 id="qbittorrent"><a href="#qbittorrent" class="headerlink" title="qbittorrent"></a>qbittorrent</h3><p>qbittorrent 是一个历史悠久的bt软件，个人觉得也是比较易用的,webui功能非常也丰富，对linux新手友好。</p>
<h4 id="安装和配置"><a href="#安装和配置" class="headerlink" title="安装和配置"></a>安装和配置</h4><p>我们的媒体中心不打算接键盘鼠标，所以只没有界面qbittorrent-nox，然后通过web界面在同一局域网的电脑上操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qbittorrent-nox</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox</span><br></pre></td></tr></table></figure>

<p>第一次运行可以看到提示<br><img src="/images/raspmediacenter/download/qt-tishi.PNG" alt="qbittorrenttishi"><br>意思是先按y同意，webui默认的用户名和密码分别是admin和adminadmin，在树莓派本机上登陆网址是<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a>,在同一局域网主机上登陆网址是<a target="_blank" rel="noopener" href="http://ip:8080/">http://ip:8080</a><br><img src="/images/raspmediacenter/download/qbwebui.PNG" alt="webui"><br><img src="/images/raspmediacenter/download/qbui.PNG" alt="webui"><br>后台运行  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox -d</span><br></pre></td></tr></table></figure>

<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>配置文件 ~&#x2F;.config&#x2F;qBittorrent&#x2F;qBittorrent.conf<br>一般不需要手动改这个文件，web界面齿轮符号是配置功能，可以修改配置。只有当忘记密码时可以修改这个文件恢复默认密码。</p>
<h4 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h4><p>Linux现在使用systemd来管理服务，我们现在也使用这种方式<br>新建一个qbittorrent-nox.service文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/lib/systemd/system/qbittorrent-nox.service</span><br></pre></td></tr></table></figure>

<p>输入下面内容并保存</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=qBittorrent-nox</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=pi</span><br><span class="line">Type=forking</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">ExecStart=/usr/bin/qbittorrent-nox -d</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start qbittorrent-nox.service</span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable qbittorrent-nox.service</span><br></pre></td></tr></table></figure>

<p>停止服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop qbittorrent-nox.service</span><br></pre></td></tr></table></figure>

<p>停止开机启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl disable qbittorrent-nox.service</span><br></pre></td></tr></table></figure>

<h4 id="加快速度"><a href="#加快速度" class="headerlink" title="加快速度"></a>加快速度</h4><p>主要是增加tracker服务器</p>
<h4 id="webui-api"><a href="#webui-api" class="headerlink" title="webui api"></a>webui api</h4><p>前端可以通过api开发自己的网页应用，只是记录一下，大家可以不看<br><a target="_blank" rel="noopener" href="https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-(qBittorrent-4.1)">https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-(qBittorrent-4.1)</a></p>
<h3 id="下载之transmission"><a href="#下载之transmission" class="headerlink" title="下载之transmission"></a>下载之transmission</h3><p>transmission也是一个轻量级bt客户端，广受好评</p>
<h4 id="安装和配置1"><a href="#安装和配置1" class="headerlink" title="安装和配置1"></a>安装和配置1</h4><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install transmission-daemon</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/transmission-deamon/settings.json</span><br></pre></td></tr></table></figure>

<p>主要修改这几项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;rpc-password&quot;:&quot;123456&quot;</span><br><span class="line">&quot;rpc-userrname&quot;:&quot;pi&quot;</span><br><span class="line">&quot;rpc-writelist&quot;: &quot;*&quot;,</span><br><span class="line">&quot;rpc-writelist-enabled&quot;:true,</span><br></pre></td></tr></table></figure>

<p>rpc-writelist是指登陆网址白名单，星号代表所有ip都可以，或者干脆将”rpc-writelist-enabled”设成false，如果你对安全比较在意也可以设置某个ip或者ip段登陆。<br>rpc-username和rpc-password就是用户名和密码，自己修改就好了。</p>
<h4 id="webui使用"><a href="#webui使用" class="headerlink" title="webui使用"></a>webui使用</h4><p>transmission默认端口是9091<br>在同一局域电脑登陆<a target="_blank" rel="noopener" href="http://ip:9091/">http://ip:9091</a><br><img src="/images/raspmediacenter/download/transmissionui.PNG" alt="transmission"></p>
<h4 id="transmission-rpc接口"><a href="#transmission-rpc接口" class="headerlink" title="transmission-rpc接口"></a>transmission-rpc接口</h4><p>   有兴趣的可以看一下<br>   <a target="_blank" rel="noopener" href="https://github.com/transmission/transmission/blob/main/docs/rpc-spec.md">https://github.com/transmission/transmission/blob/main/docs/rpc-spec.md</a></p>
<h4 id="transmission客户端"><a href="#transmission客户端" class="headerlink" title="transmission客户端"></a>transmission客户端</h4><p>   transmisission webui有一点简陋，有一些设置选项没有，可以使用transmission Qt client 里面功能就很全了。</p>
<h3 id="下载之aria2"><a href="#下载之aria2" class="headerlink" title="下载之aria2"></a>下载之aria2</h3><p>   我使用的下载工具，因为可以很方便用python调用，去自动下载某网站资源。</p>
<h4 id="安装和设置"><a href="#安装和设置" class="headerlink" title="安装和设置"></a>安装和设置</h4><p>安装  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install aria2</span><br></pre></td></tr></table></figure>

<p>配置  输入下面命令，先建立aria2文件夹，在建立aria2.session文件，当运行aria2c时默认从session文件输入链接地址，不建立时运行aria2c会提示需要文件链接。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.config/aria2/</span><br><span class="line">touch ~/.config/aria2/aria2.session</span><br></pre></td></tr></table></figure>

<p>配置文件<br>下载<a target="_blank" rel="noopener" href="https://github.com/P3TERX/aria2.conf">https://github.com/P3TERX/aria2.conf</a>文件，拷贝到 ~&#x2F;.config&#x2F;aria2&#x2F;，根据自己情况进行修改。</p>
<h4 id="开机启动aria2"><a href="#开机启动aria2" class="headerlink" title="开机启动aria2"></a>开机启动aria2</h4><p>在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system下新建aria2.serivce文件<br>输入内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Aria2 Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=pi</span><br><span class="line">ExecStart=/usr/bin/aria2c --conf-path=/home/pi/.config/aria2/aria2.conf</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>

<p>启动系统服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start aria.service</span><br><span class="line">sudo systemctl enable aria.service</span><br></pre></td></tr></table></figure>

<h4 id="安装aria2-web界面AriaNG"><a href="#安装aria2-web界面AriaNG" class="headerlink" title="安装aria2 web界面AriaNG"></a>安装aria2 web界面AriaNG</h4><p>1.安装网页服务器nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux|grep nginx|grep -v grep</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root     10132  0.0  0.2  49520  8108 ?        S    14:45   0:00 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span><br><span class="line">www-data 10134  0.0  0.0  49656  3480 ?        S    14:45   0:00 nginx: worker process</span><br><span class="line">www-data 10135  0.0  0.0  49656  2600 ?        S    14:45   0:00 nginx: worker process</span><br><span class="line">www-data 10136  0.0  0.0  49656  2600 ?        S    14:45   0:00 nginx: worker process</span><br><span class="line">www-data 10137  0.0  0.0  49656  2600 ?        S    14:45   0:00 nginx: worker process</span><br></pre></td></tr></table></figure>

<p>在浏览器输入 <a target="_blank" rel="noopener" href="http://ip/">http://ip:80</a><br><img src="/images/raspmediacenter/download/nginxinstall.PNG" alt="nginx"><br>安装成功  </p>
<p>下载AriaNg解压并拷贝到&#x2F;var&#x2F;www 目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/mayswind/AriaNg-DailyBuild/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">sudo mv AriaNg-DailyBuild-master /var/www/ariang</span><br></pre></td></tr></table></figure>

<p>配置服务器<br>在&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;下增加ariang文件。内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 6688;</span><br><span class="line">  listen [::]:6688;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    root /var/www/ariang;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AriaNG网页文件在&#x2F;var&#x2F;www&#x2F;ariang文件夹，使用6688端口<br>在浏览器中输入<a target="_blank" rel="noopener" href="http://ip:6688/">http://ip:6688</a> 出现<br><img src="/images/raspmediacenter/download/ariangwrong.PNG"><br>需要在AriaNg设置-&gt;RPC页面输入rpc密码<br><img src="/images/raspmediacenter/download/aria2miyao.PNG"><br>密钥是123456。</p>
<p>修改密钥是在aria2.conf文件中rpc-secret条目下  </p>
<h4 id="加快下载速度，添加tracker服务器"><a href="#加快下载速度，添加tracker服务器" class="headerlink" title="加快下载速度，添加tracker服务器"></a>加快下载速度，添加tracker服务器</h4><p>tracker 服务器可以帮助bt客户端连接其他客户端，是下载速度的关键因素之一。<br><a target="_blank" rel="noopener" href="https://github.com/P3TERX/aria2.conf">https://github.com/P3TERX/aria2.conf</a>下有个tracker.sh文件，执行就可以增加tracker，我们可以把tracker.sh加入定时执行，每天更新tracker。<br>使用crontab添加定时任务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>添加每天两点执行脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /home/pi/.config/aria2/tracker.sh</span><br></pre></td></tr></table></figure>

<h2 id="文件共享开启树莓派samba-server"><a href="#文件共享开启树莓派samba-server" class="headerlink" title="文件共享开启树莓派samba server"></a>文件共享开启树莓派samba server</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install samba samba-common-bin</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>编辑配置文件 &#x2F;etc&#x2F;samba&#x2F;smb.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.back</span><br><span class="line">sudo vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure>

<p>在文件末尾增加</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[pinas]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">说明信息</span></span><br><span class="line">comment = NAS Storage</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以访问用户</span></span><br><span class="line">valid users = pi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是共享文件夹,不需要密码的,就把上一句注释掉.</span></span><br><span class="line"> public = yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">共享文件夹路径，我的移动硬盘插上后自动挂载 /media/pi下面，硬盘的名称PINAS</span></span><br><span class="line">path = /media/pi/PINAS/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可被其他人看到资源名称（非内容）</span></span><br><span class="line">browseable = yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可写</span></span><br><span class="line">writable = yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建文件权限</span></span><br><span class="line">create mask = 0664</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建目录的权限</span></span><br><span class="line">directory mask = 0775</span><br></pre></td></tr></table></figure>

<p>测试配置文件是否有错误</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testparm</span><br></pre></td></tr></table></figure>

<p>添加登录用户并创建密码，需要是Linux中存在的账户，且被写在smb.conf配置文件中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd -a pi</span><br></pre></td></tr></table></figure>

<p>重启samba服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/smbd restart</span><br></pre></td></tr></table></figure>

<p>samba可以使用了</p>
<h3 id="在windows下使用"><a href="#在windows下使用" class="headerlink" title="在windows下使用"></a>在windows下使用</h3><p>保证window主机在同一局域网下，打开文件管理器，在地址栏中输入树莓派ip地址，就可以看到以pi文件夹，打开时需要用户名密码，然后就可以操作了。<br><img src="/images/raspmediacenter/samba-server/sambapiwin.png" alt="winpiuse"></p>
<h3 id="在苹果手机ios下使用"><a href="#在苹果手机ios下使用" class="headerlink" title="在苹果手机ios下使用"></a>在苹果手机ios下使用</h3><p>找到ios下面文件，选择连接服务器<br><img src="/images/raspmediacenter/samba-server/sm1.PNG" alt="1"><br>输入IP地址连接<br><img src="/images/raspmediacenter/samba-server/sm2.PNG" alt="2"><br>输入用户名密码<br><img src="/images/raspmediacenter/samba-server/sm3.PNG" alt="3"><br>成功！<br><img src="/images/raspmediacenter/samba-server/sm4.PNG" alt="4"></p>
<h3 id="在linux下使用"><a href="#在linux下使用" class="headerlink" title="在linux下使用"></a>在linux下使用</h3><p>见下一节的手动挂载samba网络共享</p>
<h2 id="树莓派挂载samba网络共享"><a href="#树莓派挂载samba网络共享" class="headerlink" title="树莓派挂载samba网络共享"></a>树莓派挂载samba网络共享</h2><h3 id="手动挂载"><a href="#手动挂载" class="headerlink" title="手动挂载"></a>手动挂载</h3><p>我有一台群晖nas，可以挂载到树莓派上，nas开了samba共享<br>手工挂载，先建立一个文件作为挂载点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/pi/Videos/qunhui </span><br></pre></td></tr></table></figure>

<p>使用mount命令挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t cifs -o username=&quot;nas&quot;,password=&quot;naspwd&quot; //192.168.31.184/movie /home/pi/Videos/qunhui</span><br></pre></td></tr></table></figure>

<p>使用umount卸载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /home/pi/Videos/qunhui</span><br></pre></td></tr></table></figure>

<h3 id="开机自动挂载"><a href="#开机自动挂载" class="headerlink" title="开机自动挂载"></a>开机自动挂载</h3><p>修改raspi-config,选择boot wait network</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raspi-config</span><br></pre></td></tr></table></figure>

<p><img src="/images/raspmediacenter/samba-client/automount1.PNG" alt="1"><br><img src="/images/raspmediacenter/samba-client/am2.PNG" alt="2"><br><img src="/images/raspmediacenter/samba-client/am3.PNG" alt="3"></p>
<p>新建用户密码文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim .cifscredz</span><br></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=test</span><br><span class="line">password=p#ssword</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;fstab</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br></pre></td></tr></table></figure>

<p>在最下面增加</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//192.168.31.184/movie /home/pi/Videos/qh-nas cifs credentials=/home/pi/.cifscredz,uid=pi,gid=pi 0 0</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chengwei</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chengwei</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
